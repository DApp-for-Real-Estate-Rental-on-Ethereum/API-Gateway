# ==================== Application Configuration ====================
spring.application.name=api-gateway
server.port=8090

# ==================== CORS Configuration ====================
# CORS is configured ONLY in SecurityConfiguration.java to avoid duplicate headers
# Disable Spring Cloud Gateway's default CORS handling
spring.cloud.gateway.server.webflux.globalcors.add-to-simple-url-handler-mapping=false

# ==================== Gateway Routes Configuration ====================
# Routes are ordered by array index. More specific routes should come first.
# Note: Using spring.cloud.gateway.server.webflux.routes for Spring Cloud Gateway Server WebFlux

# Authentication Service Routes (Port 8082 - must come first for /api/v1/auth)
spring.cloud.gateway.server.webflux.routes[0].id=auth-service
spring.cloud.gateway.server.webflux.routes[0].uri=http://localhost:8082
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/v1/auth/**
spring.cloud.gateway.server.webflux.routes[0].filters[0]=StripPrefix=0
spring.cloud.gateway.server.webflux.routes[0].filters[1]=RemoveResponseHeader=Access-Control-Allow-Origin
spring.cloud.gateway.server.webflux.routes[0].filters[2]=RemoveResponseHeader=Access-Control-Allow-Methods
spring.cloud.gateway.server.webflux.routes[0].filters[3]=RemoveResponseHeader=Access-Control-Allow-Headers
spring.cloud.gateway.server.webflux.routes[0].filters[4]=RemoveResponseHeader=Access-Control-Allow-Credentials
spring.cloud.gateway.server.webflux.routes[0].filters[5]=RemoveResponseHeader=Access-Control-Max-Age

# User Service Routes (Port 8082)
spring.cloud.gateway.server.webflux.routes[1].id=user-service
spring.cloud.gateway.server.webflux.routes[1].uri=http://localhost:8082
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/api/v1/users/**
spring.cloud.gateway.server.webflux.routes[1].filters[0]=StripPrefix=0
spring.cloud.gateway.server.webflux.routes[1].filters[1]=RemoveResponseHeader=Access-Control-Allow-Origin
spring.cloud.gateway.server.webflux.routes[1].filters[2]=RemoveResponseHeader=Access-Control-Allow-Methods
spring.cloud.gateway.server.webflux.routes[1].filters[3]=RemoveResponseHeader=Access-Control-Allow-Headers
spring.cloud.gateway.server.webflux.routes[1].filters[4]=RemoveResponseHeader=Access-Control-Allow-Credentials
spring.cloud.gateway.server.webflux.routes[1].filters[5]=RemoveResponseHeader=Access-Control-Max-Age

# Property Service Routes (Port 8081)
spring.cloud.gateway.server.webflux.routes[2].id=property-service
spring.cloud.gateway.server.webflux.routes[2].uri=http://localhost:8081
spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/api/v1/properties/**
spring.cloud.gateway.server.webflux.routes[2].filters[0]=StripPrefix=0

# Booking Service Routes (Port 8083)
spring.cloud.gateway.server.webflux.routes[3].id=booking-service
spring.cloud.gateway.server.webflux.routes[3].uri=http://localhost:8083
spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/api/bookings/**
spring.cloud.gateway.server.webflux.routes[3].filters[0]=StripPrefix=0

# Payment Service Routes (Port 8085)
spring.cloud.gateway.server.webflux.routes[4].id=payment-service
spring.cloud.gateway.server.webflux.routes[4].uri=http://localhost:8085
spring.cloud.gateway.server.webflux.routes[4].predicates[0]=Path=/api/payments/**
spring.cloud.gateway.server.webflux.routes[4].filters[0]=StripPrefix=0

# Reclamation Service Routes (Port 8091)
spring.cloud.gateway.server.webflux.routes[5].id=reclamation-service
spring.cloud.gateway.server.webflux.routes[5].uri=http://localhost:8091
spring.cloud.gateway.server.webflux.routes[5].predicates[0]=Path=/api/reclamations/**
spring.cloud.gateway.server.webflux.routes[5].filters[0]=StripPrefix=0

# Admin Reclamation Service Routes (Port 8091)
spring.cloud.gateway.server.webflux.routes[6].id=admin-reclamation-service
spring.cloud.gateway.server.webflux.routes[6].uri=http://localhost:8091
spring.cloud.gateway.server.webflux.routes[6].predicates[0]=Path=/api/admin/reclamations/**
spring.cloud.gateway.server.webflux.routes[6].filters[0]=StripPrefix=0

# Notification Service Routes (Port 8084)
spring.cloud.gateway.server.webflux.routes[7].id=notification-service
spring.cloud.gateway.server.webflux.routes[7].uri=http://localhost:8084
spring.cloud.gateway.server.webflux.routes[7].predicates[0]=Path=/api/notifications/**
spring.cloud.gateway.server.webflux.routes[7].filters[0]=StripPrefix=0

# ==================== Gateway Performance & Timeout Configuration ====================
# Connection timeout for downstream services (milliseconds)
spring.cloud.gateway.server.webflux.httpclient.connect-timeout=5000
spring.cloud.gateway.server.webflux.httpclient.response-timeout=30000

# Connection pool settings
spring.cloud.gateway.server.webflux.httpclient.pool.max-connections=500
spring.cloud.gateway.server.webflux.httpclient.pool.max-idle-time=30000

# ==================== JWT Security Configuration ====================
# 256-bit (32-byte) base64-encoded secret key for HMAC-SHA algorithms
# MUST be at least 256 bits (32 bytes) for security compliance
# Generate new key: openssl rand -base64 32
security.jwt.secret-key=${JWT_SECRET_KEY:C9QmotKEmQrr6M5/sLWeacExfgXyBfAlzEXurAftGZO1u/K7Ua04a0sNWSddMs3WZqgiJjxt3NvD/Ju/eTbeHA==}
security.jwt.expiration-time=86400000

# ==================== Actuator & Health Checks ====================
# Enable health check endpoint (useful for monitoring)
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
management.health.gateway.enabled=true

# ==================== Logging Configuration ====================
# Debug logging for gateway routing (set to DEBUG only when diagnosing)
logging.level.org.springframework.cloud.gateway=INFO
logging.level.ma.fstt.apigateway=INFO
# Reduce noise from other components
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=INFO
